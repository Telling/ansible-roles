global:
  smtp_smarthost: '{{ alertmanager_smtp_server }}:{{ alertmanager_smtp_port }}'
  smtp_from: '{{ alertmanager_smtp_from }}'
{% if alertmanager_smtp_username is defined %}
  smtp_auth_username: '{{ alertmanager_smtp_username }}'
{% endif %}
{% if alertmanager_smtp_password is defined %}
  smtp_auth_password: '{{ alertmanager_smtp_password }}'
{% endif %}
  smtp_require_tls: "{{ alertmanager_smtp_tls }}"

templates:
- '/usr/local/etc/alertmanager/template/*.tmpl'

route:
  group_by: ['alertname', 'instance']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 3h
  receiver: sysadmins

inhibit_rules:
- source_match:
    severity: 'critical'
  target_match:
    severity: 'warning'
  equal: ['alertname', 'instance']

receivers:
- name: 'sysadmins'
  email_configs:
  - to: '{{ alertmanager_admin_email }}'
{% if alertmanager_slack_url is defined %}
  slack_configs:
  - send_resolved: true
    api_url: {{ alertmanager_slack_url }}
    channel: {{ alertmanager_slack_channel }}
{% endif %}

